From 0716de18d3aad7956a80e0df1aa51afb07b908b4 Mon Sep 17 00:00:00 2001
From: Alexey Veprev <alexey.veprev@intel.com>
Date: Wed, 13 Jan 2021 16:09:00 +0300
Subject: [PATCH] CMake: fix Clang compiler detection on macOS

---
 cmake/compilers/Clang.cmake | 39 +++++++++++++++++++------------------
 1 file changed, 20 insertions(+), 19 deletions(-)

diff --git a/cmake/compilers/Clang.cmake b/cmake/compilers/Clang.cmake
index 78943128..fddf1cc1 100644
--- a/cmake/compilers/Clang.cmake
+++ b/cmake/compilers/Clang.cmake
@@ -12,28 +12,29 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
-set(TBB_LINK_DEF_FILE_FLAG -Wl,--version-script=)
-set(TBB_DEF_FILE_PREFIX lin${TBB_ARCH})
-set(TBB_MMD_FLAG -MMD)
-set(TBB_WARNING_LEVEL -Wall -Wextra $<$<BOOL:${TBB_STRICT}>:-Werror>)
-set(TBB_TEST_WARNING_FLAGS -Wshadow -Wcast-qual -Woverloaded-virtual -Wnon-virtual-dtor)
-set(TBB_WARNING_SUPPRESS -Wno-parentheses -Wno-non-virtual-dtor -Wno-dangling-else)
+if (APPLE)
+    include(${CMAKE_CURRENT_LIST_DIR}/AppleClang.cmake)
+else()
+    set(TBB_LINK_DEF_FILE_FLAG -Wl,--version-script=)
+    set(TBB_DEF_FILE_PREFIX lin${TBB_ARCH})
+    set(TBB_MMD_FLAG -MMD)
+    set(TBB_WARNING_LEVEL -Wall -Wextra $<$<BOOL:${TBB_STRICT}>:-Werror>)
+    set(TBB_TEST_WARNING_FLAGS -Wshadow -Wcast-qual -Woverloaded-virtual -Wnon-virtual-dtor)
+    set(TBB_WARNING_SUPPRESS -Wno-parentheses -Wno-non-virtual-dtor -Wno-dangling-else)
 
-if (CMAKE_SYSTEM_PROCESSOR STREQUAL x86_64)
-    set(TBB_COMMON_COMPILE_FLAGS -mrtm)
-endif()
+    if (CMAKE_SYSTEM_PROCESSOR STREQUAL x86_64)
+        set(TBB_COMMON_COMPILE_FLAGS -mrtm)
+    endif()
 
-set(TBB_COMMON_LINK_LIBS dl)
+    set(TBB_COMMON_LINK_LIBS dl)
 
-set(TBB_WARNING_SUPPRESS -Wno-non-virtual-dtor -Wno-dangling-else)
-if (ANDROID_PLATFORM)
-    set(TBB_COMMON_COMPILE_FLAGS $<$<NOT:$<CONFIG:Debug>>:-D_FORTIFY_SOURCE=2>)
-endif()
+    set(TBB_WARNING_SUPPRESS -Wno-non-virtual-dtor -Wno-dangling-else)
+    if (ANDROID_PLATFORM)
+        set(TBB_COMMON_COMPILE_FLAGS $<$<NOT:$<CONFIG:Debug>>:-D_FORTIFY_SOURCE=2>)
+    endif()
 
-if (NOT APPLE)
     set(TBB_WARNING_SUPPRESS -Wno-parentheses)
-endif()
-
-# TBB malloc settings
-set(TBBMALLOC_LIB_COMPILE_FLAGS -fno-rtti -fno-exceptions)
 
+    # TBB malloc settings
+    set(TBBMALLOC_LIB_COMPILE_FLAGS -fno-rtti -fno-exceptions)
+endif()
-- 
2.19.0.windows.1

